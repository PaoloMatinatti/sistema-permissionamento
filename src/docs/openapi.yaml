openapi: 3.0.0
info:
  title: API de Sistema de Permissionamento
  version: 1.0.0
  description: API para gerenciamento de sistemas, permissões, grupos/papéis e usuários,
    incluindo associações e consulta de permissões por usuário.
servers:
- url: http://localhost:3000
  description: Servidor local
tags:
- name: Sistemas
- name: Permissões
- name: Grupos
- name: Usuários
- name: Associações
- name: Autorização
paths:
  /sistemas:
    get:
      tags:
      - Sistemas
      summary: Listar sistemas
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Sistema'
    post:
      tags:
      - Sistemas
      summary: Criar sistema
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SistemaInput'
      responses:
        '201':
          description: Criado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Sistema'
        '400':
          description: Erro de validação
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erro'
  /sistemas/{id}:
    get:
      tags:
      - Sistemas
      summary: Obter sistema por id
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Sistema'
        '404':
          description: Não encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erro'
    put:
      tags:
      - Sistemas
      summary: Atualizar sistema
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SistemaInput'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Sistema'
        '404':
          description: Não encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erro'
    delete:
      tags:
      - Sistemas
      summary: Remover sistema
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
      responses:
        '204':
          description: Removido
        '404':
          description: Não encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erro'
  /permissoes:
    get:
      tags:
      - Permissões
      summary: Listar permissões
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Permissao'
    post:
      tags:
      - Permissões
      summary: Criar permissão
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PermissaoInput'
      responses:
        '201':
          description: Criado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Permissao'
        '400':
          description: Erro de validação
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erro'
  /permissoes/{id}:
    get:
      tags:
      - Permissões
      summary: Obter permissão por id
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Permissao'
        '404':
          description: Não encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erro'
    put:
      tags:
      - Permissões
      summary: Atualizar permissão
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PermissaoInput'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Permissao'
        '404':
          description: Não encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erro'
    delete:
      tags:
      - Permissões
      summary: Remover permissão
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
      responses:
        '204':
          description: Removido
        '404':
          description: Não encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erro'
  /grupos:
    get:
      tags:
      - Grupos
      summary: Listar grupos/papéis
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Grupo'
    post:
      tags:
      - Grupos
      summary: Criar grupo/papel
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GrupoInput'
      responses:
        '201':
          description: Criado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Grupo'
        '400':
          description: Erro de validação
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erro'
  /grupos/{id}:
    get:
      tags:
      - Grupos
      summary: Obter grupo por id
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Grupo'
        '404':
          description: Não encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erro'
    put:
      tags:
      - Grupos
      summary: Atualizar grupo
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GrupoInput'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Grupo'
        '404':
          description: Não encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erro'
    delete:
      tags:
      - Grupos
      summary: Remover grupo
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
      responses:
        '204':
          description: Removido
        '404':
          description: Não encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erro'
  /usuarios:
    get:
      tags:
      - Usuários
      summary: Listar usuários (query opcional email)
      parameters:
      - name: email
        in: query
        required: false
        schema:
          type: string
        example: maria@empresa.com
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Usuario'
    post:
      tags:
      - Usuários
      summary: Criar usuário
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UsuarioInput'
      responses:
        '201':
          description: Criado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Usuario'
        '400':
          description: Erro de validação
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erro'
  /usuarios/{id}:
    get:
      tags:
      - Usuários
      summary: Obter usuário por id
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Usuario'
        '404':
          description: Não encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erro'
    put:
      tags:
      - Usuários
      summary: Atualizar usuário
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UsuarioInput'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Usuario'
        '404':
          description: Não encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erro'
    delete:
      tags:
      - Usuários
      summary: Remover usuário
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
      responses:
        '204':
          description: Removido
        '404':
          description: Não encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erro'
  /grupos/{idGrupo}/permissoes:
    post:
      tags:
      - Associações
      summary: Associar permissões a um grupo
      parameters:
      - name: idGrupo
        in: path
        required: true
        schema:
          type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IdsInputPermissoes'
      responses:
        '200':
          description: Permissões atuais do grupo
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Permissao'
    get:
      tags:
      - Associações
      summary: Listar permissões de um grupo
      parameters:
      - name: idGrupo
        in: path
        required: true
        schema:
          type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Permissao'
  /grupos/{idGrupo}/permissoes/{idPermissao}:
    delete:
      tags:
      - Associações
      summary: Remover uma permissão de um grupo
      parameters:
      - name: idGrupo
        in: path
        required: true
        schema:
          type: integer
      - name: idPermissao
        in: path
        required: true
        schema:
          type: integer
      responses:
        '204':
          description: Removido
  /usuarios/{idUsuario}/grupos:
    post:
      tags:
      - Associações
      summary: Associar grupos a um usuário
      parameters:
      - name: idUsuario
        in: path
        required: true
        schema:
          type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IdsInputGrupos'
      responses:
        '200':
          description: Grupos atuais do usuário
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Grupo'
    get:
      tags:
      - Associações
      summary: Listar grupos de um usuário
      parameters:
      - name: idUsuario
        in: path
        required: true
        schema:
          type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Grupo'
  /usuarios/{idUsuario}/grupos/{idGrupo}:
    delete:
      tags:
      - Associações
      summary: Remover um grupo de um usuário
      parameters:
      - name: idUsuario
        in: path
        required: true
        schema:
          type: integer
      - name: idGrupo
        in: path
        required: true
        schema:
          type: integer
      responses:
        '204':
          description: Removido
  /usuarios/{idUsuario}/permissoes:
    get:
      tags:
      - Autorização
      summary: Dado um usuário, retornar permissões associadas (agrupadas por sistema)
      parameters:
      - name: idUsuario
        in: path
        required: true
        schema:
          type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PermissaoUsuarioResponse'
        '404':
          description: Usuário não encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erro'
components:
  schemas:
    Sistema:
      type: object
      properties:
        id:
          type: integer
          example: 1
        nome:
          type: string
          example: ERP
        descricao:
          type: string
          nullable: true
          example: Sistema de gestão da empresa
      required:
      - id
      - nome
    SistemaInput:
      type: object
      properties:
        nome:
          type: string
          example: ERP
        descricao:
          type: string
          example: Sistema de gestão da empresa
      required:
      - nome
    Permissao:
      type: object
      properties:
        id:
          type: integer
          example: 1
        nome:
          type: string
          example: USERS_READ
        descricao:
          type: string
          nullable: true
          example: Pode listar usuários
        sistema_id:
          type: integer
          example: 1
      required:
      - id
      - nome
      - sistema_id
    PermissaoInput:
      type: object
      properties:
        nome:
          type: string
          example: USERS_READ
        descricao:
          type: string
          example: Pode listar usuários
        sistema_id:
          type: integer
          example: 1
      required:
      - nome
      - sistema_id
    Grupo:
      type: object
      properties:
        id:
          type: integer
          example: 1
        nome:
          type: string
          example: ADMIN_ERP
        descricao:
          type: string
          nullable: true
          example: Administradores do ERP
        sistema_id:
          type: integer
          example: 1
      required:
      - id
      - nome
      - sistema_id
    GrupoInput:
      type: object
      properties:
        nome:
          type: string
          example: ADMIN_ERP
        descricao:
          type: string
          example: Administradores do ERP
        sistema_id:
          type: integer
          example: 1
      required:
      - nome
      - sistema_id
    Usuario:
      type: object
      properties:
        id:
          type: integer
          example: 1
        nome:
          type: string
          example: Maria Silva
        email:
          type: string
          example: maria@empresa.com
      required:
      - id
      - nome
      - email
    UsuarioInput:
      type: object
      properties:
        nome:
          type: string
          example: Maria Silva
        email:
          type: string
          example: maria@empresa.com
      required:
      - nome
      - email
    IdsInputPermissoes:
      type: object
      properties:
        permissoesIds:
          type: array
          items:
            type: integer
          example:
          - 1
          - 2
          - 3
      required:
      - permissoesIds
    IdsInputGrupos:
      type: object
      properties:
        gruposIds:
          type: array
          items:
            type: integer
          example:
          - 1
          - 2
      required:
      - gruposIds
    PermissaoUsuarioResponse:
      type: object
      properties:
        usuarioId:
          type: integer
          example: 1
        nome:
          type: string
          example: Maria Silva
        email:
          type: string
          example: maria@empresa.com
        permissoesPorSistema:
          type: object
          additionalProperties:
            type: array
            items:
              type: object
              properties:
                id:
                  type: integer
                  example: 1
                codigo:
                  type: string
                  example: USERS_READ
                descricao:
                  type: string
                  example: Pode listar usuários
              required:
              - id
              - codigo
          example:
            ERP:
            - id: 1
              codigo: USERS_READ
              descricao: Pode listar usuários
      required:
      - usuarioId
      - nome
      - email
      - permissoesPorSistema
    Erro:
      type: object
      properties:
        mensagem:
          type: string
          example: Recurso não encontrado
      required:
      - mensagem
